var app=angular.module("kp",[]).config(function($locationProvider){}).controller("MainController",["$scope","$location","$http","$templateCache","$compile","$timeout","PlaygroundAPI","LertService",function($scope,$location,$http,$templateCache,$compile,$timeout,playgroundAPI,lerts){var params=$location.search();$scope.playground={_id:null,name:"",user:"kentendo",html:"",css:"",js:""},$scope.autoRefresh=!0,$scope.showOutput="false"===params.output?!1:!0,$scope.showHTML="false"===params.html?!1:!0,$scope.showCSS="false"===params.css?!1:!0,$scope.showJS="false"===params.js?!1:!0,$scope.showCode=!0,$scope.toolHeight="33.3333%",$scope.iframeWidth="66.6666%",$scope.edited=!1,$scope.mirrorRefresh=function(){$scope.mirrorJs&&($scope.mirrorJs.refresh(),$scope.mirrorCss.refresh(),$scope.mirrorHtml.refresh())},$scope.$watchGroup(["showHTML","showCSS","showJS"],function(){$scope.toolHeight=$scope.getToolHeight(),$scope.toolWidth=$scope.getToolWidth(),$scope.iframeWidth=$scope.getIframeWidth(),$scope.showCode=0===$scope.getToolCount()?!1:!0,$timeout(function(){$scope.mirrorRefresh()})}),$scope.getToolCount=function(){return Number($scope.showHTML)+Number($scope.showCSS)+Number($scope.showJS)},$scope.getToolHeight=function(){return String(Number(100/$scope.getToolCount()).toFixed(4))+"%"},$scope.getToolWidth=function(){return $scope.showOutput?"33.3333%":"100%"},$scope.getIframeWidth=function(){return 0===$scope.getToolCount()?"100%":"66.6666%"},$scope.$watch("playground.name",function(){$scope.edited=!0}),$scope.$watchGroup(["playground.html","playground.css","playground.js"],function(){$scope.autoRefresh&&$scope.refresh(),$scope.edited=!0}),$scope.get=function(id){playgroundAPI.get(id).success(function(data,status,headers,config){data.success?($scope.playground=data.data,$timeout(function(){$scope.edited=!1,$scope.mirrorHtml=CodeMirror.fromTextArea(document.getElementById("html"),{lineNumbers:!0,mode:"htmlmixed",theme:"mbo"}),$scope.mirrorHtml.on("change",function(instance,changeObj){$scope.playground.html=$scope.mirrorHtml.getValue(),$scope.$apply()}),$scope.mirrorCss=CodeMirror.fromTextArea(document.getElementById("css"),{lineNumbers:!0,mode:"css",theme:"mbo"}),$scope.mirrorCss.on("change",function(instance,changeObj){$scope.playground.css=$scope.mirrorCss.getValue(),$scope.$apply()}),$scope.mirrorJs=CodeMirror.fromTextArea(document.getElementById("js"),{lineNumbers:!0,mode:"javascript",theme:"mbo"}),$scope.mirrorJs.on("change",function(instance,changeObj){$scope.playground.js=$scope.mirrorJs.getValue(),$scope.$apply()})},0,!0),lerts.lert("success","Loaded "+$scope.playground.name)):(lerts.lert("error","Not found"),$location.path("/"))}).error(function(data,status,headers,config){lerts.lert("error","Could not connect to api")})},$scope.refresh=function(){var iframe=document.getElementById("iframe");iframe.srcdoc="<!DOCTYPE html><html><head><style>"+$scope.playground.css+"</style></head><body>"+$scope.playground.html+"<script>"+$scope.playground.js+"</script></body></html>"},$scope.create=function(){playgroundAPI.create($scope.playground).success(function(data,status,headers,config){0===data.length?$scope["new"]():(lerts.lert("success","Created dat"),$scope.playground._id=data.data,$location.path(data.data))}).error(function(data,status,headers,config){lerts.lert("error","Couldn't create dat")})},$scope.update=function(){playgroundAPI.update($scope.playground).success(function(data,status,headers,config){lerts.lert("success","Saved dat"),$scope.edited=!1}).error(function(data,status,headers,config){lerts.lert("error","Couldn	 save dat")})},$scope.save=function(){return $scope.edited===!1?(lerts.lert("error","No edits"),!1):""===$scope.playground.html&&""===$scope.playground.css&&""===$scope.playground.js?(lerts.lert("error","Das blank"),!1):(""===$scope.playground.name&&($scope.playground.name=prompt("Name dat or don't do dat...")),void($scope.playground._id?$scope.update():$scope.create()))},$location.path()?$scope.get($location.path().slice(1)):lerts.lert("success","Do dis")}]);app.factory("PlaygroundAPI",["$http",function($http){var apiUrl="http://playground.kennycosca.com/api/";return{get:function(id){return $http({method:"get",url:apiUrl+id})},create:function(data){return delete data._id,$http({method:"post",url:apiUrl,data:data})},update:function(data){var id=data._id;return delete data._id,$http({method:"post",url:apiUrl+id,data:data})}}}]);